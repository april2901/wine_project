<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë‚´ ì™€ì¸ ë¦¬ìŠ¤íŠ¸</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <!-- í”Œë˜ì‹œ ë©”ì‹œì§€ -->
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <div class="flash-messages">
                {% for category, message in messages %}
                    <div class="flash-{{ category }}">{{ message }}</div>
                {% endfor %}
            </div>
        {% endif %}
    {% endwith %}

    <!-- í—¤ë” -->
    <div class="header">
        <h1>ğŸ· ë‚´ ì™€ì¸ ë¦¬ìŠ¤íŠ¸</h1>
        <div class="header-right">
            <div class="view-toggle">
                <span class="view-button active">ğŸ“‹ ë¦¬ìŠ¤íŠ¸ ëª¨ë“œ</span>
                <!-- ë¡œê·¸ì¸ ìƒíƒœì™€ ê´€ê³„ì—†ì´ ì…€ëŸ¬ ëª¨ë“œ ë²„íŠ¼ í‘œì‹œ -->
                <a href="{{ url_for('cellar_view') }}" class="view-button">ğŸ  ì…€ëŸ¬ ëª¨ë“œ</a>
            </div>
            
            <div class="search-container">
                <form method="GET" class="search-form">
                    <input type="text" name="search" placeholder="ì™€ì¸ ì´ë¦„, êµ­ê°€, ì§€ì—­, í’ˆì¢…..." value="{{ search_query }}">
                    <button type="submit" class="search-button">ê²€ìƒ‰</button>
                </form>
            </div>
            
            {% if session.logged_in %}
                <span class="user-info">{{ session.username }}ë‹˜ í™˜ì˜í•©ë‹ˆë‹¤</span>
                <a href="{{ url_for('add_wine') }}" class="add-button">+ ì™€ì¸ ì¶”ê°€</a>
                <a href="{{ url_for('logout') }}" class="logout-button">ë¡œê·¸ì•„ì›ƒ</a>
            {% else %}
                <a href="{{ url_for('login') }}" class="login-button">ë¡œê·¸ì¸</a>
            {% endif %}
        </div>
    </div>

    <!-- ì™€ì¸ ëª©ë¡ -->
    {% if wines %}
        <div class="wine-grid">
            {% for wine in wines %}
            <div class="wine-card">
                <div class="wine-name">{{ wine[1] }}</div>
                
                <div class="wine-details">
                    <div class="wine-info">
                        <span class="info-label">êµ­ê°€:</span> {{ wine[2] or 'N/A' }} | 
                        <span class="info-label">ì§€ì—­:</span> {{ wine[3] or 'N/A' }}
                    </div>
                    <div class="wine-info">
                        <span class="info-label">ì—°ë„:</span> {{ wine[4] or 'N/A' }} | 
                        <span class="info-label">í’ˆì¢…:</span> {{ wine[5] or 'N/A' }}
                    </div>
                    
                    {% if wine[6] %}
                    <div class="wine-price">{{ "{:,}".format(wine[6]|int) }}ì›</div>
                    {% endif %}
                    
                    <!-- ìœ„ì¹˜ ì •ë³´ í‘œì‹œ -->
                    {% if wine|length > 9 and wine[9] %}
                    <div class="wine-location">
                        <span class="info-label">ìœ„ì¹˜:</span> 
                        ì„ ë°˜ {{ wine[9] }}
                        {% if wine[10] %} - ìœ„ì¹˜ {{ wine[10] }}{% endif %}
                    </div>
                    {% endif %}
                </div>
                
                {% if wine[7] %}
                <div class="wine-note">"{{ wine[7] }}"</div>
                {% endif %}
                
                <div class="wine-date">ì¶”ê°€ì¼: {{ wine[8] }}</div>
                
                {% if session.logged_in %}
                <div class="actions">
                    <a href="{{ url_for('edit_wine', wine_id=wine[0]) }}" class="edit-link">ìˆ˜ì •</a>
                    <a href="#" onclick="deleteWine({{ wine[0] }})" class="delete-link">ì‚­ì œ</a>
                </div>
                {% endif %}
            </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="no-wines">
            <h3>ì•„ì§ ë“±ë¡ëœ ì™€ì¸ì´ ì—†ìŠµë‹ˆë‹¤.</h3>
            <p>ì²« ë²ˆì§¸ ì™€ì¸ì„ ì¶”ê°€í•´ë³´ì„¸ìš”!</p>
            {% if session.logged_in %}
            <a href="{{ url_for('add_wine') }}" class="add-button">ì™€ì¸ ì¶”ê°€í•˜ê¸°</a>
            {% else %}
            <p><a href="{{ url_for('login') }}" class="login-button">ë¡œê·¸ì¸</a>í•˜ì—¬ ì™€ì¸ì„ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
            {% endif %}
        </div>
    {% endif %}

    <script>
        function deleteWine(wineId) {
            if (confirm('ì •ë§ë¡œ ì´ ì™€ì¸ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                fetch(`/delete/${wineId}`, {
                    method: 'POST',
                })
                .then(response => {
                    if (response.ok) {
                        location.reload();
                    } else {
                        alert('ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                });
            }
        }
    </script>
</body>
</html>