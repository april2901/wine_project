<!-- templates/index.html -->
{% extends "layout.html" %}

{% block header %}
  {% if query is defined %}
    "{{ query }}" 검색 결과
  {% else %}
    내 와인 리스트
  {% endif %}
{% endblock %}

{% block header_buttons %}
<!-- 검색 폼 -->
<div class="search-container">
  <form action="/search" method="GET" class="search-form">
    <input type="text" name="query" placeholder="와인 이름, 국가 검색..." value="{{ query if query is defined else '' }}">
    <button type="submit" class="search-button">검색</button>
  </form>
</div>

<!-- 로그인한 사용자만 와인 추가 버튼 표시 -->
{% if session.logged_in %}
<a href="/add" class="add-button">와인 추가</a>
{% endif %}

{% if query is defined %}
<a href="/" class="back-button">전체 목록으로</a>
{% endif %}
{% endblock %}

{% block content %}
{% if wines %}
<div class="wine-grid">
    {% for wine in wines %}
    <div class="wine-card">
        <div class="wine-name">{{ wine['name'] }}</div>
        
        <div class="wine-details">
            <!-- 기본 정보 -->
            <div class="wine-info">
                <span class="info-label">국가:</span> {{ wine['country'] }}
                {% if wine['region'] %}
                    <span class="info-divider">|</span> <span class="info-label">지역:</span> {{ wine['region'] }}
                {% endif %}
            </div>
            
            <!-- 추가 정보 -->
            <div class="wine-info">
                {% if wine['year'] %}
                    <span class="info-label">생산년도:</span> {{ wine['year'] }}
                {% endif %}
                
                {% if wine['grape_variety'] %}
                    <span class="info-divider">|</span> <span class="info-label">포도품종:</span> {{ wine['grape_variety'] }}
                {% endif %}
            </div>
            
            <!-- 가격 정보 -->
            {% if wine['price'] %}
            <div class="wine-price">
                <span class="info-label">가격:</span> {{ "{:,}".format(wine['price']) }}원
            </div>
            {% endif %}
        </div>
        
        <!-- 메모 -->
        {% if wine['note'] %}
        <div class="wine-note">
            <span class="note-icon">📝</span> "{{ wine['note'] }}"
        </div>
        {% endif %}
        
        <!-- 추가 날짜 -->
        {% if wine['date_added'] %}
        <div class="wine-date">
            추가일: {{ wine['date_added'].split()[0] }}
        </div>
        {% endif %}
        
        <!-- 로그인한 사용자만 편집/삭제 버튼 표시 -->
        {% if session.logged_in %}
        <div class="actions">
            <a href="/edit/{{ wine['id'] }}" class="edit-link">수정</a>
            <a href="#" class="delete-link" data-id="{{ wine['id'] }}" data-name="{{ wine['name'] }}">삭제</a>
        </div>
        {% endif %}
    </div>
    {% endfor %}
</div>
{% else %}
<div class="no-wines">
    {% if query is defined %}
    <p>"{{ query }}" 검색 결과가 없습니다.</p>
    <a href="/">전체 와인 목록 보기</a>
    {% else %}
    <p>등록된 와인이 없습니다.</p>
    {% if session.logged_in %}
        <a href="/add">"와인 추가" 버튼을 클릭하여 와인을 추가해보세요.</a>
    {% else %}
        <p>와인을 추가하려면 <a href="/login">로그인</a>이 필요합니다.</p>
    {% endif %}
    {% endif %}
</div>
{% endif %}
{% endblock %}